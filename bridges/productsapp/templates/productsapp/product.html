{% extends 'productsapp/base.html' %}
{% load static %}
{% block content-container %}

<!-- Main Content -->
<div id="main-content" class="site-main clearfix">
    <div id="content-wrap">
        <div id="site-content" class="site-content clearfix">
            <div id="inner-content" class="inner-content-wrap">
                <div class="page-content">
                    <section class="wprt-section">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="wprt-spacer" data-desktop="40" data-mobi="30" data-smobi="30"></div>
                                </div><!-- /.col-md-12 -->
<!--КРАТКОЕ ОПИСАНИЕ-->
                                <div class="col-md-12">
                                    <div>
                                        <h3 class="line-height-normal margin-bottom-10">КРАТКОЕ ОПИСАНИЕ</h3>
                                        {% if request.user.is_superuser %}
                                        <a href="{% url 'products:product_update' object.pk %}">редактировать</a>
                                        {% endif %}
                                        <div class="wprt-lines style-1 custom-3">
                                            <div class="line-1"></div>
                                            <div class="line-2"></div>
                                        </div>

                                        <div class="wprt-spacer" data-desktop="30" data-mobi="25" data-smobi="25"></div>

                                        <p>{{ object.short_desc }}</p>
                                        <p>{{ object.description }}</p>
                                    </div>
                                </div><!-- /.col-md-12 -->
<!--ДОСТУПНЫЕ СЕРВИСЫ ПО ПРОДУКТУ-->
{#                                <div class="col-md-4">#}
{#                                    <div class="wprt-spacer" data-desktop="0" data-mobi="20" data-smobi="20"></div>#}
{##}
{#                                    <h3 class="line-height-normal margin-bottom-10">ДОСТУПНЫЕ СЕРВИСЫ</h3>#}
{#                                    <div class="wprt-lines style-1 custom-3">#}
{#                                        <div class="line-1"></div>#}
{#                                        <div class="line-2"></div>#}
{#                                    </div>#}
{##}
{#                                    <div class="wprt-spacer" data-desktop="30" data-mobi="25" data-smobi="25"></div>#}
{#                                    {% if request.user.is_superuser %}#}
{#                                    <a href="{% url 'products:product_service_update' object.pk %}">редактировать</a>#}
{#                                    {% endif %}#}
{#                                    {% if user.is_authenticated %}#}
{#                                        <p><a href="{% url 'orders:order_create' object.pk %}"#}
{#                                              class="wprt-button small">ЗАКАЗАТЬ</a></p>#}
{#                                    {% endif %}#}
{#                                </div><!-- /.col-md-4 -->#}
<!--СОСТАВ РАБОТ И МАТЕРИАЛОВ-->
                                <div class="col-md-12">
                                    <div class="wprt-spacer" data-desktop="30" data-mobi="60" data-smobi="60"></div>
                                    <div>
                                        <h3 class="line-height-normal margin-bottom-10">СОСТАВ РАБОТ И МАТЕРИАЛОВ</h3>
                                        <div class="wprt-lines style-1 custom-3">
                                            <div class="line-1"></div>
                                            <div class="line-2"></div>
                                        </div>

                                        <div class="wprt-spacer" data-desktop="30" data-mobi="25" data-smobi="25"></div>

                                        <p>Ниже представлен типовой состав материалов. Полный комплекс мероприятий,
                                            а также условия их проведения и методы контроля качества определяется проектной и
                                            рабочей документацией, а также Технологическим регламентом. Рекомендуемый
                                            к применению технологический реглмент Вы можете загрузить на этой странице
                                            ниже в разделе "Исследования и документация".</p>
                                    </div>
                                </div>
                                    <div class="col-md-12">
                                        <div class="wprt-toggle active style-1">
                                            <h3 class="toggle-title">Состав материалов</h3>
                                            <div class="toggle-content" style="font-family: 'Times New Roman'; font-size: larger;
                                            color: #4d4949;">
                                                <table id="table">
                                                    <tr>
                                                        <td style="text-align: center; font-weight: bold; width: 3%">№</td>
                                                        <td style="text-align: center; font-weight: bold;">Название</td>
                                                        <td style="text-align: center; font-weight: bold; width: 15%">Расход, кг/м.кв</td>
                                                        <td style="text-align: center; font-weight: bold; width: 15%">Кол-во, кг</td>
                                                        <td style="text-align: center; font-weight: bold; width: 15%">Цена, руб/кг</td>
                                                        <td style="text-align: center; font-weight: bold; width: 15%">Итого, руб</td>
                                                    </tr>
                                                    {% for item in materials %}
                                                        <tr class="FORM">
                                                            <td style="text-align: center;">{{ forloop.counter }}</td>
                                                            <td style="text-align: right;"><i>
                                                                {{ item.material }}
                                                            </i></td>
                                                            <td style="text-align: center;" id="{{ forloop.counter }}-consumption">
                                                                {{ item.consumption }}
                                                            </td>
                                                            <td style="text-align: center;" id="{{ forloop.counter }}-quantity">
                                                                #t_quant
                                                            </td>
                                                            <td style="text-align: center;" id="{{ forloop.counter }}-price">
                                                                {{ item.material.price }}
                                                            </td>
                                                            <td style="text-align: center;" id="{{ forloop.counter }}-cost">
                                                                #t_cost
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                        <tr>
                                                            <td style="text-align: right; font-weight: bold; width: 3%" colspan="5">ИТОГО, руб (с НДС)</td>
                                                            <td style="text-align: center; font-weight: bold; width: 15%" id="TOTAL"></td>
                                                        </tr>
                                                        <tr>
                                                            <td style="text-align: right; font-weight: bold; width: 3%" colspan="5">в том числе НДС</td>
                                                            <td style="text-align: center; font-weight: bold; width: 15%" id="TAX"></td>
                                                        </tr>
                                                </table>
                                                <form action="">
                                                <label for="quantity">Объем работ:</label>
                                                    <input type="number" style="font-size: 0.7em; width: 150px;" min="1" max="200000" value="{{ object.quantity }}" id="quantity">
                                                    <a href="##" class="wprt-button small">РАСЧИТАТЬ</a>
                                                <a href="##"
{#                                              class="wprt-button small wop">ЗАКАЗАТЬ</a>
                                                </form>
                                                {% if request.user.is_superuser %}
                                                <a href="{% url 'products:product_work_update' object.pk %}">редактировать</a>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div><!-- /.row -->
<!--СТАТЬЯ О ТЕХНИЧЕСКОМ РЕШЕНИИ- /ЖУРНАЛЫ И ТД/ PDF LOADER-->
                            {% if publications %}
                                <div class="col-md-12">
                                    <div class="wprt-spacer" data-desktop="30" data-mobi="30" data-smobi="60"></div>
                                    <div>
                                        <h3 class="line-height-normal margin-bottom-10">ПУБЛИКАЦИИ И НАУЧНЫЕ СТАТЬИ</h3>
                                        <div class="wprt-lines style-1 custom-3">
                                            <div class="line-1"></div>
                                            <div class="line-2"></div>
                                        </div>
                                        <div class="wprt-spacer" data-desktop="30" data-mobi="25" data-smobi="25"></div>
                                    </div>
                                </div><!-- /.col-md-12 -->

                                <div class="col-md-12">
                                    <div class="wprt-project has-bullets has-arrows bullet-style-2 arrow-position-2" data-layout="slider" data-column="4" data-column2="3" data-column3="2" data-column4="1" data-gaph="15" data-gapv="15">
                                        <div id="projects" class="cbp">
                                            {% for item in publications %}
                                            <div class="cbp-item">
                                                <div class="project-item">
                                                    <div class="inner">
                                                        <div class="grid">
                                                            {% for i in item.file.all %}
                                                                <a target="_blank" href="/media/{{ i.file }}">
                                                                <figure class="effect-sadie" style="height: 420px; margin-top: -58px; margin-left: -3px;">

                                                                    <object><embed src="/media/{{ i.file }}" alt="image" width=300px; height=600px;" /></object>
                                                                    <figcaption>
                                                                        <div>
                                                                            <h2></h2>
                                                                            <p>{{ i.alt_desc }}</p>
                                                                        </div>
                                                                    </figcaption>
                                                                </figure></a>
                                                                {% endfor %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div><!--/.cbp-item -->
                                            {% endfor %}
                                        </div><!-- /#projects -->
                                    </div><!--/.wprt-project -->
                                </div><!-- /.col-md-12 -->
                            {% endif %}
<!--ВЫПОЛНЕННЫЕ ПРОЕКТЫ-->
                            {% if projects %}
                                <div class="col-md-12">
                                    <div class="wprt-spacer" data-desktop="30" data-mobi="60" data-smobi="60"></div>
                                    <div>
                                        <h3 class="line-height-normal margin-bottom-10">ВЫПОЛНЕННЫЕ ПРОЕКТЫ</h3>
                                        <div class="wprt-lines style-1 custom-3">
                                            <div class="line-1"></div>
                                            <div class="line-2"></div>
                                        </div>
                                        <div class="wprt-spacer" data-desktop="30" data-mobi="25" data-smobi="25"></div>
                                    </div>
                                </div><!-- /.col-md-12 -->

                                <div class="col-md-12">
                                    <div class="wprt-project has-bullets has-arrows bullet-style-2 arrow-position-2" data-layout="slider" data-column="4" data-column2="3" data-column3="2" data-column4="1" data-gaph="15" data-gapv="15">
                                        <div id="projects" class="cbp">
                                            {% for item in projects %}
                                            <div class="cbp-item">
                                                <div class="project-item">
                                                    <div class="inner">
                                                        <div class="grid">
                                                            <figure class="effect-honey">
                                                            <a href="{% url 'projects:project' item.project.pk %}">
                                                                <img src="/media/{{ item.project.image | default:"projects_images/avatars/no_avatar.jpg" }}"
                                                                     alt="{{ item.name }}">
                                                            </a>
                                                                <figcaption>
                                                                        <h2>
                                                                            <a href="{% url 'projects:project' item.project.pk %}">{{ item.project.name }}</a>
                                                                        </h2>
                                                                        <p></p>
                                                                </figcaption>
                                                            </figure>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div><!--/.cbp-item -->
                                            {% endfor %}
                                        </div><!-- /#projects -->
                                    </div><!--/.wprt-project -->
                                </div><!-- /.col-md-12 -->
                            {% endif %}

<!--ОТЗЫВЫ-->
                            {% if feedback %}
                                <div class="col-md-12">
                                    <div class="wprt-spacer" data-desktop="30" data-mobi="30" data-smobi="60"></div>
                                    <div>
                                        <h3 class="line-height-normal margin-bottom-10">ОТЗЫВЫ ЗАКАЗЧИКОВ И ПОДРЯДЧИКОВ</h3>
                                        <div class="wprt-lines style-1 custom-3">
                                            <div class="line-1"></div>
                                            <div class="line-2"></div>
                                        </div>
                                        <div class="wprt-spacer" data-desktop="30" data-mobi="25" data-smobi="25"></div>
                                    </div>
                                </div><!-- /.col-md-12 -->

                                <div class="col-md-12">
                                    <div class="wprt-project has-bullets has-arrows bullet-style-2 arrow-position-2" data-layout="slider" data-column="4" data-column2="3" data-column3="2" data-column4="1" data-gaph="15" data-gapv="15">
                                        <div id="projects" class="cbp">
                                            {% for item in feedback %}
                                            <div class="cbp-item">
                                                <div class="project-item">
                                                    <div class="inner">
                                                        <div class="grid">
                                                            {% for i in item.file.all %}
                                                                <figure class="effect-sadie" style="height: 420px; margin-top: -58px; margin-left: -3px;">
                                                                <a target="_blank" href="/media/{{ i.file }}">
                                                                    <object><embed src="/media/{{ i.file }}" alt="image" width=300px; height=600px;" /></object>
                                                                    <figcaption>
                                                                        <div>
                                                                            <h2></h2>
                                                                            <p style="color: whitesmoke;">{{ i.alt_desc }}</p>
                                                                        </div>
                                                                    </figcaption>
                                                                </a>
                                                                </figure>
                                                                {% endfor %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div><!--/.cbp-item -->
                                            {% endfor %}
                                        </div><!-- /#projects -->
                                    </div><!--/.wprt-project -->
                                </div><!-- /.col-md-12 -->
                            {% endif %}

<!--ДОКУМЕНТАЦИЯ О ПРОДУКТЕ-->
                            {% if documents or researches %}
                                <div class="col-md-12">
                                    <div class="wprt-spacer" data-desktop="30" data-mobi="60" data-smobi="60"></div>
                                    <h2 class="line-height-normal margin-bottom-10">ИССЛЕДОВАНИЯ И ДОКУМЕНТАЦИЯ</h2>
                                    <div class="wprt-lines style-1 custom-3">
                                        <div class="line-1"></div>
                                        <div class="line-2"></div>
                                    </div>
                                    <div class="wprt-spacer" data-desktop="25" data-mobi="25" data-smobi="25"></div>
                                </div>

                                <div class="col-md-6 row">
                                    {% for item in researches %}
                                        <div class="wprt-toggle style-1">
                                            <h3 class="toggle-title">{{ item.name }}</h3>
                                            <div class="toggle-content" style="color: black;">
                                                {% for i in item.file.all %}
                                                    {{ item.description }}
                                                    <div class="wprt-spacer" data-desktop="10" data-mobi="10"
                                                         data-smobi="10"></div>
                                                    <a class="wprt-button small rounded-30px" href="/media/{{ i.file }}"
                                                       target="_blank">СКАЧАТЬ PDF</a>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div><!-- /.col-md-12 -->

                                <div class="col-md-6 row">
                                    {% for item in documents %}
                                        <div class="wprt-toggle style-2">
                                            <h3 class="toggle-title">{{ item.name }}</h3>
                                            <div class="toggle-content" style="color: black;">
                                                {% for i in item.file.all %}
                                                    {{ item.description }}
                                                    <div class="wprt-spacer" data-desktop="10" data-mobi="10"
                                                         data-smobi="10">

                                                    </div>
                                                    <a class="wprt-button small rounded-30px" href="/media/{{ i.file }}"
                                                       target="_blank">СКАЧАТЬ PDF</a>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div><!-- /.col-md-6 -->
                            {% endif %}
<!--/ ДОКУМЕНТАЦИЯ О ПРОДУКТЕ-->
                                <div class="col-md-12">
                                    <div class="wprt-spacer" data-desktop="80" data-mobi="60" data-smobi="60"></div>
                                </div><!-- /.col-md-12 -->
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>
</div>
<!--/ Main Content -->
    <script>

{#  =====================  ЗАПОЛНЕНИЕ ТАБЛИЦЫ КОЛИЧЕСТВАМИ МАТЕРИАЛОВ И ЦЕНАМИ  =======================  #}

    window.onload = function () {
        let consumption, price, orderTotalCost = 0, quantityArr = [], costArr = [];
        let TOTAL_FORMS = document.querySelectorAll('.FORM');
        let quantity = parseInt(document.getElementById('quantity').value);


        for(let i = 1; i <=TOTAL_FORMS.length; i++){
            consumption = parseFloat(document.getElementById(i + '-consumption').innerText.replace(',', '.'));
            price = parseFloat(document.getElementById(i + '-price').innerText.replace(',','.'));
            quantityArr[i-1] = (consumption * quantity);
            document.getElementById(i + '-quantity').innerText = quantityArr[i-1].toFixed(2);
            costArr[i-1] = (quantityArr[i-1] * price);
            document.getElementById(i + '-cost').innerText = costArr[i-1].toFixed(2);
            orderTotalCost += costArr[i-1];
        }
        document.getElementById('TOTAL').innerText = orderTotalCost.toFixed(2);
        document.getElementById('TAX').innerText = ((orderTotalCost / 1.2) * 0.2).toFixed(2);
    };

{# =======================  СООБЩЕНИЕ: "КНОПКА В РЕЖИМЕ РАЗРАБОТКИ"  ==========================  #}

    let wopButtons = document.querySelectorAll('.wop');
    wopButtons.forEach(function (item) {
        item.addEventListener('click', function () {
            alert('В разработке')
        })
    });

{#  ======================  АВТОМАТИЧЕСКИЙ РАСЧЕТ СТОИМОСТИ ЗАКАЗА  =====================  #}

    document.querySelector('form input[type="number"]').addEventListener("change", function () {
        console.log(this.value);
        let consumption, price, orderTotalCost = 0, quantityArr = [], costArr = [];
        let TOTAL_FORMS = document.querySelectorAll('.FORM');
        for(let i = 1; i <=TOTAL_FORMS.length; i++){
            consumption = parseFloat(document.getElementById(i + '-consumption').innerText.replace(',', '.'));
            price = parseFloat(document.getElementById(i + '-price').innerText.replace(',','.'));
            quantityArr[i-1] = (consumption * this.value);
            document.getElementById(i + '-quantity').innerText = quantityArr[i-1].toFixed(2);
            costArr[i-1] = (quantityArr[i-1] * price);
            document.getElementById(i + '-cost').innerText = costArr[i-1].toFixed(2);
            orderTotalCost += costArr[i-1];
        }
        document.getElementById('TOTAL').innerText = orderTotalCost.toFixed(2);
        document.getElementById('TAX').innerText = ((orderTotalCost / 1.2) * 0.2).toFixed(2);
    })
    </script>
{% endblock %}
